<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>My Profile</title>

   <link rel="stylesheet" href="../scss/bootstrap.css">
   <link rel="stylesheet" href="../style/style.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

</head>

<body data-bs-theme="dark">

   <header class="position-sticky top-0 z-3 bg-body"></header>

   <script>
      const token = localStorage.getItem("token");
      if (!token) location.href = "../auth/login.html";
   </script>

   <div class="container mt-4 col-lg-7">

      <!-- <h4 class="text-center text-light mb-3">My Profile</h4> -->

      <div class="row m-auto justify-content-center">
         <div class="col-lg-7">
            <div class="card border mb-4 p-3 rounded-4">
               <img id="avatar" class="rounded-circle mb-2" style="width:80px;height:80px;object-fit:cover;">
               
                  <input id="avatar_up" type="file" src="" alt="">
                  <button class="btn btn-primary rounded-4 fw-medium mt-2" onclick="edit()">Update Avatar</button>
                  <button class="btn btn-primary rounded-4 fw-medium mt-2" onclick="delete_avatar()">Delete Avatar</button>
               <p id="id">ID: </p>
               <p id="email">Email: </p>
               <div class="d-flex">
                  <h5 id="name" class=""></h5>
                  &nbsp;
                  <h5 id="lastName" class=""></h5>
               </div>
            </div>
            <!-- <div class="text-end mb-3 position-fixed end-0 bottom-0 me-5 z-3">
               <a class="btn btn-primary rounded-4 fw-medium" href="../article/create_article.html">
                  <i class="fa fa-plus"></i>
                  Create Article
               </a>
            </div> -->
            <div class="row py-5 gap-5" id="articleList"></div>
         </div>
      </div>

   </div>

   <script src="../js/bootstrap.bundle.min.js"></script>
   <script src="profile.js" type="module"></script>
   <script>
      const baseUrl = "http://blogs.csm.linkpc.net/api/v1";

      function edit() {
         formData = new FormData();
         let avatarFile = document.getElementById("avatar_up");
         formData.append("avatar", avatarFile.files[0]);
         fetch(baseUrl + "/profile/avatar",{
            method: "POST",
            headers: { Authorization: `Bearer ${token}` },
            body: formData
         })
         .then(res => res.json())
         .then(data => {
            location.reload();
         })
      }  
      
      function delete_avatar() {
         fetch(baseUrl + "/profile/avatar",{
            method: "DELETE",
            headers: { Authorization: `Bearer ${token}` },
         })
         .then(res => res.json())
         .then(data => {
            location.reload();
         })
      }
      
   </script>
</body>

</html>